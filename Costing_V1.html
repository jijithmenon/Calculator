<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Labour & Food Cost Calculator</title>
    <style>
        * {
            box-sizing: border-box;
        }
        
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 10px;
            background-color: #f5f5f5;
        }
        
        .section {
            background: white;
            padding: 15px;
            margin-bottom: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            overflow-x: auto;
        }
        
        h2 { 
            color: #333; 
            margin-top: 0;
            font-size: 18px;
        }
        
        /* Table styling */
        .table-container {
            overflow-x: auto;
            -webkit-overflow-scrolling: touch;
        }
        
        table { 
            border-collapse: collapse; 
            width: 100%; 
            margin-top: 15px;
            min-width: 600px; /* Prevents table from becoming too narrow */
        }
        
        th, td { 
            border: 1px solid #ddd; 
            padding: 6px 4px;
            text-align: right; 
            font-size: 12px;
        }
        
        th { 
            background-color: #4472C4; 
            color: white; 
            text-align: center; 
            font-weight: bold;
            position: sticky;
            top: 0;
            z-index: 10;
        }
        
        /* Input fields */
        input { 
            width: 55px; 
            border: 1px solid #ccc; 
            padding: 4px 2px;
            text-align: right;
            font-size: 12px;
        }
        
        input.wide {
            width: 150px;
        }
        
        /* Cell styling */
        .fixed { 
            background-color: #e8f0f8 !important; 
            font-weight: bold; 
            text-align: left;
            padding-left: 6px;
        }
        
        .special { 
            background-color: #ffe6cc !important; 
        }
        
        .total { 
            font-weight: bold; 
            background-color: #fff2cc; 
        }
        
        .grandtotal { 
            background-color: #ffff00; 
            font-weight: bold; 
        }
        
        /* Button styling */
        .button-container {
            margin-top: 15px;
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
        }
        
        button { 
            padding: 10px 14px;
            background: #007cba; 
            color: white; 
            border: none; 
            cursor: pointer; 
            border-radius: 4px;
            font-size: 14px;
            flex: 1 1 auto;
            min-width: 140px;
        }
        
        button:hover { 
            background: #0056b3; 
        }
        
        button.add-btn {
            background: #28a745;
        }
        
        button.add-btn:hover {
            background: #218838;
        }
        
        /* Mobile optimizations */
        @media (max-width: 768px) {
            body {
                padding: 5px;
            }
            
            .section {
                padding: 10px;
                margin-bottom: 15px;
            }
            
            h2 {
                font-size: 16px;
            }
            
            th, td {
                font-size: 11px;
                padding: 5px 3px;
            }
            
            input {
                width: 50px;
                font-size: 11px;
                padding: 3px 2px;
            }
            
            input.wide {
                width: 120px;
            }
            
            button {
                font-size: 13px;
                padding: 8px 10px;
                min-width: 120px;
            }
            
            /* Make first two columns sticky on mobile */
            .labour-table td:nth-child(1),
            .labour-table th:nth-child(1),
            .labour-table td:nth-child(2),
            .labour-table th:nth-child(2) {
                position: sticky;
                background-color: inherit;
                z-index: 5;
            }
            
            .labour-table th:nth-child(1),
            .labour-table td:nth-child(1) {
                left: 0;
            }
            
            .labour-table th:nth-child(2),
            .labour-table td:nth-child(2) {
                left: 80px;
            }
        }
        
        @media (max-width: 480px) {
            h2 {
                font-size: 14px;
            }
            
            th, td {
                font-size: 10px;
                padding: 4px 2px;
            }
            
            input {
                width: 45px;
                font-size: 10px;
            }
            
            input.wide {
                width: 100px;
            }
            
            button {
                font-size: 12px;
                padding: 7px 8px;
                min-width: 100px;
            }
            
            .button-container {
                gap: 6px;
            }
        }
        
        /* Grand total section styling */
        .grand-total-table {
            min-width: 300px;
        }
        
        .grand-total-table td {
            font-size: 14px;
            padding: 10px;
        }
        
        .final-total-row {
            background-color: #ff6b6b; 
            color: white; 
            font-size: 16px;
        }
        
        @media (max-width: 480px) {
            .grand-total-table td {
                font-size: 12px;
                padding: 8px;
            }
            
            .final-total-row {
                font-size: 14px;
            }
        }
        
        /* Scroll hint */
        .scroll-hint {
            text-align: center;
            color: #666;
            font-size: 11px;
            margin-top: 5px;
            display: none;
        }
        
        @media (max-width: 768px) {
            .scroll-hint {
                display: block;
            }
        }
    </style>
</head>
<body>
    <!-- LABOUR COST SECTION -->
    <div class="section">
        <h2>‚öôÔ∏è LABOUR COST CALCULATOR</h2>
        <div class="table-container">
            <table id="laborTable" class="labour-table">
                <thead>
                    <tr>
                        <th>Category</th>
                        <th>Name</th>
                        <th>Order</th>
                        <th>Loading</th>
                        <th>Shifts</th>
                        <th>Extra</th>
                        <th>Rates</th>
                        <th>Fare</th>
                        <th>Total</th>
                    </tr>
                </thead>
                <tbody id="tableBody"></tbody>
                <tfoot>
                    <tr class="grandtotal">
                        <td colspan="2"><strong>TOTAL</strong></td>
                        <td id="totalC">-</td>
                        <td id="totalD">-</td>
                        <td id="totalE">-</td>
                        <td id="totalF">-</td>
                        <td id="totalG">-</td>
                        <td id="totalH">-</td>
                        <td id="totalI">-</td>
                    </tr>
                </tfoot>
            </table>
        </div>
        <p class="scroll-hint">‚Üê Scroll horizontally to see all columns ‚Üí</p>
        <div class="button-container">
            <button onclick="resetToOriginal()">üîÑ Reset</button>
            <button onclick="exportLabourCSV()">üì• Export CSV</button>
        </div>
    </div>

    <!-- FOOD COST SECTION -->
    <div class="section">
        <h2>üçΩÔ∏è FOOD COST CALCULATOR</h2>
        <div class="table-container">
            <table>
                <thead>
                    <tr>
                        <th>Category</th>
                        <th>Name</th>
                        <th>Rate</th>
                        <th>Units</th>
                        <th>Total</th>
                    </tr>
                </thead>
                <tbody id="food-cost-body"></tbody>
                <tfoot>
                    <tr class="grandtotal">
                        <td colspan="4"><strong>TOTAL</strong></td>
                        <td id="food-grand-total">0.00</td>
                    </tr>
                </tfoot>
            </table>
        </div>
        <p class="scroll-hint">‚Üê Scroll horizontally to see all columns ‚Üí</p>
        <div class="button-container">
            <button onclick="resetFoodCosts()">üîÑ Reset</button>
            <button onclick="exportFoodCSV()">üì• Export CSV</button>
        </div>
    </div>

    <!-- OTHERS SECTION -->
    <div class="section">
        <h2>üìã OTHERS</h2>
        <div class="table-container">
            <table>
                <thead>
                    <tr>
                        <th>Category</th>
                        <th>Name</th>
                        <th>Rate</th>
                        <th>Units</th>
                        <th>Fare</th>
                        <th>Total</th>
                    </tr>
                </thead>
                <tbody id="others-cost-body"></tbody>
                <tfoot>
                    <tr class="grandtotal">
                        <td colspan="5"><strong>TOTAL</strong></td>
                        <td id="others-grand-total">0</td>
                    </tr>
                </tfoot>
            </table>
        </div>
        <p class="scroll-hint">‚Üê Scroll horizontally to see all columns ‚Üí</p>
        <div class="button-container">
            <button onclick="resetOthersCosts()">üîÑ Reset</button>
            <button onclick="exportOthersCSV()">üì• Export CSV</button>
        </div>
    </div>

    <!-- GRAND TOTAL SECTION -->
    <div class="section">
        <h2>üí∞ GRAND TOTAL</h2>
        <div class="table-container">
            <table class="grand-total-table">
                <tr class="grandtotal">
                    <td><strong>Labour Cost</strong></td>
                    <td id="final-labour-total">0</td>
                </tr>
                <tr class="grandtotal">
                    <td><strong>Food Cost</strong></td>
                    <td id="final-food-total">0.00</td>
                </tr>
                <tr class="grandtotal">
                    <td><strong>Others Cost</strong></td>
                    <td id="final-others-total">0.00</td>
                </tr>
                <tr class="final-total-row">
                    <td><strong>GRAND TOTAL</strong></td>
                    <td id="final-grand-total">0.00</td>
                </tr>
            </table>
        </div>
    </div>

    <script>
        // ===== LABOUR COST CALCULATOR =====
        const originalData = [
            { cat: "Kitchen Stewarding", name: "SANJAY", order: 0, loading: 0, shifts: 0, extra: 0, rates: 550, fare: 0, usesSpecialFormula: true, showSpecialColor: false },
            { cat: "Kitchen Stewarding", name: "SHEKHAR(500/1500/2000)", order: 0, loading: 0, shifts: 0, extra: 0, rates: 600, fare: 0, usesSpecialFormula: true, showSpecialColor: false },
            { cat: "Kitchen Stewarding", name: "MANOJ", order: 0, loading: 0, shifts: 0, extra: 0, rates: 525, fare: 0, usesSpecialFormula: true, showSpecialColor: false },
            { cat: "ROJYA", name: "ANAND/RAJ/FAROOQ", order: 0, loading: 0, shifts: 0, extra: 0, rates: 500, fare: 0, usesSpecialFormula: false, showSpecialColor: false },
            { cat: "SERVICE BOY", name: "RAKESH", order: 0, loading: 0, shifts: 0, extra: 0, rates: 495, fare: 0, usesSpecialFormula: false, showSpecialColor: false },
            { cat: "MAHARAJ", name: "VIJAY", order: 0, loading: 0, shifts: 0, extra: 0, rates: 1600, fare: 0, usesSpecialFormula: false, showSpecialColor: false },
            { cat: "BAI", name: "MAHARAJ", order: 0, loading: 0, shifts: 0, extra: 0, rates: 400, fare: 0, usesSpecialFormula: false, showSpecialColor: false },
            { cat: "TAI WAITER", name: "SONU/BABU", order: 0, loading: 0, shifts: 0, extra: 0, rates: 550, fare: 0, usesSpecialFormula: false, showSpecialColor: false },
            { cat: "Model", name: "MONICA/GUJARAT", order: 0, loading: 0, shifts: 0, extra: 0, rates: 2850, fare: 0, usesSpecialFormula: false, showSpecialColor: false },
            { cat: "GUJARAT", name: "KARIGAR", order: 0, loading: 0, shifts: 0, extra: 0, rates: 1500, fare: 0, usesSpecialFormula: false, showSpecialColor: false },
            { cat: "PRO", name: "MINAL/SHEETAL/RESHMA", order: 0, loading: 0, shifts: 0, extra: 0, rates: 1500, fare: 0, usesSpecialFormula: false, showSpecialColor: false },
            { cat: "PRO", name: "GIRLS", order: 0, loading: 0, shifts: 0, extra: 0, rates: 1200, fare: 0, usesSpecialFormula: false, showSpecialColor: false },
            { cat: "CATERING BOYS", name: "COLLEGE", order: 0, loading: 0, shifts: 0, extra: 0, rates: 800, fare: 0, usesSpecialFormula: false, showSpecialColor: false },
            { cat: "LIVE MITHAI", name: "PARASNATJI", order: 0, loading: 0, shifts: 0, extra: 0, rates: 1500, fare: 0, usesSpecialFormula: false, showSpecialColor: false },
            { cat: "SOUTH INDIAN", name: "RAMESH/SUNDAR", order: 0, loading: 0, shifts: 0, extra: 0, rates: 1475, fare: 0, usesSpecialFormula: false, showSpecialColor: false },
            { cat: "TANDOOR", name: "AMIR BHAI", order: 0, loading: 0, shifts: 0, extra: 0, rates: 1500, fare: 0, usesSpecialFormula: false, showSpecialColor: false },
            { cat: "PANI PURI", name: "MADAM/SAHIL", order: 0, loading: 0, shifts: 0, extra: 0, rates: 20, fare: 0, usesSpecialFormula: false, showSpecialColor: false },
            { cat: "BARBECUE", name: "PINTU", order: 0, loading: 0, shifts: 0, extra: 0, rates: 1300, fare: 0, usesSpecialFormula: false, showSpecialColor: false },
            { cat: "BT COUNTER", name: "GORELAL", order: 0, loading: 0, shifts: 0, extra: 0, rates: 1500, fare: 0, usesSpecialFormula: false, showSpecialColor: false },
            { cat: "FARSAN", name: "BHARAT", order: 0, loading: 0, shifts: 0, extra: 0, rates: 215, fare: 0, usesSpecialFormula: false, showSpecialColor: false },
            { cat: "KARIGAR", name: "RAJESH", order: 0, loading: 0, shifts: 0, extra: 0, rates: 1500, fare: 0, usesSpecialFormula: false, showSpecialColor: false },
            { cat: "MANAGERS", name: "SUMITRA", order: 0, loading: 0, shifts: 0, extra: 0, rates: 3500, fare: 0, usesSpecialFormula: false, showSpecialColor: false }
        ];

        function populateTable() {
            const tbody = document.getElementById('tableBody');
            tbody.innerHTML = '';
            
            originalData.forEach((data) => {
                const row = tbody.insertRow();
                row.innerHTML = `
                    <td class="fixed">${data.cat}</td>
                    <td class="fixed">${data.name}</td>
                    <td><input type="number" class="order" value="${data.order}" min="0" onchange="calculateAll()"></td>
                    <td><input type="number" class="loading" value="${data.loading}" min="0" onchange="calculateAll()"></td>
                    <td><input type="number" class="shifts" value="${data.shifts}" min="0" onchange="calculateAll()"></td>
                    <td><input type="number" class="extra" value="${data.extra}" min="0" onchange="calculateAll()"></td>
                    <td class="fixed">${data.rates}</td>
                    <td><input type="number" class="fare" value="${data.fare}" step="0.01" min="0" onchange="calculateAll()"></td>
                    <td class="rowTotal">-</td>
                `;
            });
            calculateAll();
        }

        function calculateRow(rowIndex) {
            const row = document.querySelectorAll('#tableBody tr')[rowIndex];
            const data = originalData[rowIndex];
            
            const order = parseFloat(row.cells[2].querySelector('input.order').value) || 0;
            const loading = parseFloat(row.cells[3].querySelector('input.loading').value) || 0;
            const shifts = parseFloat(row.cells[4].querySelector('input.shifts').value) || 0;
            const extra = parseFloat(row.cells[5].querySelector('input.extra').value) || 0;
            const rates = parseFloat(row.cells[6].textContent) || 0;
            const fare = parseFloat(row.cells[7].querySelector('input.fare').value) || 0;
            
            let total;
            if (data.usesSpecialFormula) {
                // Special formula: (E*G)+(F*G)+((C-D)*H)
                total = (shifts * rates) + (extra * rates) + ((order - loading) * fare);
            } else {
                // Regular formula: (E*G)+(C*H)+(F*G)
                total = (shifts * rates) + (order * fare) + (extra * rates);
            }
            
            row.cells[8].textContent = Math.round(total);
            return { order, loading, shifts, extra, rates, fare, total };
        }

        function calculateAll() {
            let totals = { order: 0, loading: 0, shifts: 0, extra: 0, rates: 0, fare: 0, grand: 0 };
            const rows = document.querySelectorAll('#tableBody tr');
            
            rows.forEach((row, index) => {
                const rowData = calculateRow(index);
                totals.order += rowData.order;
                totals.loading += rowData.loading;
                totals.shifts += rowData.shifts;
                totals.extra += rowData.extra;
                totals.rates += rowData.rates;
                totals.fare += rowData.fare;
                totals.grand += rowData.total;
            });

            document.getElementById('totalC').textContent = totals.order.toFixed(0);
            document.getElementById('totalD').textContent = totals.loading.toFixed(0);
            document.getElementById('totalE').textContent = totals.shifts.toFixed(0);
            document.getElementById('totalF').textContent = totals.extra.toFixed(0);
            document.getElementById('totalG').textContent = totals.rates.toFixed(0);
            document.getElementById('totalH').textContent = totals.fare.toFixed(0);
            document.getElementById('totalI').textContent = totals.grand.toFixed(0);
            
            updateGrandTotal();
        }

        function resetToOriginal() {
            populateTable();
        }

        function exportLabourCSV() {
            let csv = 'Category,Name,Order,Loading+Unloading,Shifts,Extra Shifts,Rates,Fare,Total\n';
            const rows = document.querySelectorAll('#tableBody tr');
            rows.forEach(row => {
                csv += [
                    '"' + row.cells[0].textContent + '"',
                    '"' + row.cells[1].textContent + '"',
                    row.cells[2].querySelector('input').value,
                    row.cells[3].querySelector('input').value,
                    row.cells[4].querySelector('input').value,
                    row.cells[5].querySelector('input').value,
                    row.cells[6].textContent,
                    row.cells[7].querySelector('input').value,
                    row.cells[8].textContent
                ].join(',') + '\n';
            });
            downloadCSV(csv, 'labour-costs.csv');
        }

        // ===== FOOD COST CALCULATOR =====
        const foodItems = [
            { cat: "PROVISION", name: "VASHI/KALYAN/KETAN/METRO", rate: 0 },
            { cat: "VEGETABLES", name: "SACHIN/DATTA/BHOLA", rate: 0 },
            { cat: "Milk", name: "MORYA/PRADEEP/MANOJ", rate: 0 },
            { cat: "SALIM BREAD", name: "SALIM", rate: 0 },
            { cat: "ITALIAN COUNTER", name: "PIZZA/PASTA/SIZZLER", rate: 0 },
            { cat: "RASGULLA/RASMALAI", name: "ANGOORI/RASGULLA", rate: 450 },
            { cat: "MITHAI & DRY FRUITS", name: "GULAB JAMUN/BADAM KATLI", rate: 1100 },
            { cat: "BASKIN/NATURAL", name: "TJUK/DADAR/CHANDAN", rate: 1200 },
            { cat: "WAFFLE", name: "BELGIUM/LEKHA", rate: 65 },
            { cat: "JAWAN KHICHIYA", name: "JAWAN", rate: 20 },
            { cat: "AAMRAS", name: "SHEETAL", rate: 330 },
            { cat: "COLD STONE", name: "DEVANG BHAI", rate: 60 },
            { cat: "SPECIAL MITHAI", name: "KUNAFA", rate: 30 },
            { cat: "DRY ICE", name: "DRY ICE", rate: 35 },
            { cat: "Juice", name: "NANKU/MEWA/SAMEER", rate: 45 },
            { cat: "FRUIT", name: "NANKU/MEWA/SAMEER", rate: 65 },
            { cat: "MOCKTAIL", name: "RAJU BHAI", rate: 85 },
            { cat: "DESSERT", name: "LEKHA/BELGIUM", rate: 55 },
            { cat: "GAS", name: "SUMITRA", rate: 1650 },
            { cat: "CHARCOAL", name: "LAKDIWALA", rate: 32 },
            { cat: "SIZZLER AND TAWA", name: "AMIT", rate: 145 },
            { cat: "ICE BLOCKS", name: "JUGAL/RAMU", rate: 500 },
            { cat: "WATER", name: "ALKALINE", rate: 45 },
            { cat: "Water JAR", name: "JAR/KK/BISLERI", rate: 30 },
            { cat: "Water BOTTLE 200ML", name: "CLEAR/KK/ETC", rate: 4.4 }
        ];

        function renderFoodTable() {
            const container = document.getElementById('food-cost-body');
            if (!container) return;

            let html = '';
            foodItems.forEach(item => {
                html += `
                    <tr>
                        <td class="fixed">${item.cat}</td>
                        <td class="fixed">${item.name}</td>
                        <td><input type="number" class="food-rate" value="${item.rate}" step="0.01" oninput="calculateFoodTotal()"></td>
                        <td><input type="number" class="food-unit" value="0" step="0.01" oninput="calculateFoodTotal()"></td>
                        <td class="food-row-total">0.00</td>
                    </tr>`;
            });
            container.innerHTML = html;
        }

        function calculateFoodTotal() {
            let total = 0;
            document.querySelectorAll('#food-cost-body tr').forEach(row => {
                const r = parseFloat(row.querySelector('.food-rate').value) || 0;
                const u = parseFloat(row.querySelector('.food-unit').value) || 0;
                const rowSum = r * u;
                row.querySelector('.food-row-total').innerText = rowSum.toFixed(2);
                total += rowSum;
            });
            document.getElementById('food-grand-total').innerText = total.toFixed(2);
            updateGrandTotal();
        }

        function resetFoodCosts() {
            renderFoodTable();
            calculateFoodTotal();
        }

        function exportFoodCSV() {
            let csv = 'Category,Name,Rate,Units,Total\n';
            const rows = document.querySelectorAll('#food-cost-body tr');
            rows.forEach(row => {
                csv += [
                    '"' + row.cells[0].textContent + '"',
                    '"' + row.cells[1].textContent + '"',
                    row.querySelector('.food-rate').value,
                    row.querySelector('.food-unit').value,
                    row.querySelector('.food-row-total').textContent
                ].join(',') + '\n';
            });
            downloadCSV(csv, 'food-costs.csv');
        }

        // ===== OTHERS COST CALCULATOR =====
        const othersItems = [
            { cat: "DISPOSABLE ITEMS", name: "NEELKANT/PIYUSH", rate: 0, units: 1, fare: 0 },
            { cat: "TRANSPORT", name: "ANNA/PORTER", rate: 0, units: 1, fare: 0 },
            { cat: "LOCAL PURCHASE", name: "LOCAL AREA", rate: 0, units: 1, fare: 0 },
            { cat: "BREAKAGES", name: "SUMITRA", rate: 0, units: 1, fare: 0 },
            { cat: "GOLDEN SET", name: "NASIR/ASLAM", rate: 0, units: 1, fare: 0 },
            { cat: "MOUTH FRESHENER", name: "PANDEY/CHANDAN", rate: 30, units: 0, fare: 0 },
            { cat: "UTENSILS", name: "SUMITRA/HEMA", rate: 0, units: 1, fare: 0 },
            { cat: "PAGRI", name: "PAPPU", rate: 35, units: 0, fare: 0 },
            { cat: "COUNTER SET UP", name: "PANDAY/KAMAL/KARAN/PAPPU", rate: 0, units: 1, fare: 0 },
            { cat: "MISCELLANEOUS", name: "RENT/INTEREST ETC", rate: 0, units: 1, fare: 0 },
            { cat: "WALKIE TALKIE", name: "WALKIE", rate: 120, units: 0, fare: 1000 },
            { cat: "SIR", name: "SUMITRA", rate: 0, units: 1, fare: 0 }
        ];

        function renderOthersTable() {
            const container = document.getElementById('others-cost-body');
            if (!container) return;

            let html = '';
            othersItems.forEach(item => {
                html += `
                    <tr>
                        <td class="fixed">${item.cat}</td>
                        <td class="fixed">${item.name}</td>
                        <td><input type="number" class="others-rate" value="${item.rate}" step="0.01" oninput="calculateOthersTotal()"></td>
                        <td><input type="number" class="others-unit" value="${item.units}" step="0.01" oninput="calculateOthersTotal()"></td>
                        <td><input type="number" class="others-fare" value="${item.fare}" step="0.01" oninput="calculateOthersTotal()"></td>
                        <td class="others-row-total">0</td>
                    </tr>`;
            });
            container.innerHTML = html;
        }

        function calculateOthersTotal() {
            let total = 0;
            document.querySelectorAll('#others-cost-body tr').forEach(row => {
                const rate = parseFloat(row.querySelector('.others-rate').value) || 0;
                const units = parseFloat(row.querySelector('.others-unit').value) || 0;
                const fare = parseFloat(row.querySelector('.others-fare').value) || 0;
                // Formula: Total = (Rate * Units) + Fare
                const rowSum = (rate * units) + fare;
                row.querySelector('.others-row-total').innerText = Math.round(rowSum);
                total += rowSum;
            });
            document.getElementById('others-grand-total').innerText = Math.round(total);
            updateGrandTotal();
        }

        function resetOthersCosts() {
            renderOthersTable();
            calculateOthersTotal();
        }

        function exportOthersCSV() {
            let csv = 'Category,Name,Rate,Units,Fare,Total\n';
            const rows = document.querySelectorAll('#others-cost-body tr');
            rows.forEach(row => {
                csv += [
                    '"' + row.cells[0].textContent + '"',
                    '"' + row.cells[1].textContent + '"',
                    row.querySelector('.others-rate').value,
                    row.querySelector('.others-unit').value,
                    row.querySelector('.others-fare').value,
                    row.querySelector('.others-row-total').textContent
                ].join(',') + '\n';
            });
            downloadCSV(csv, 'others-costs.csv');
        }

        // ===== GRAND TOTAL =====
        function updateGrandTotal() {
            const labourTotal = parseFloat(document.getElementById('totalI').textContent) || 0;
            const foodTotal = parseFloat(document.getElementById('food-grand-total').textContent) || 0;
            const othersTotal = parseFloat(document.getElementById('others-grand-total').textContent) || 0;
            
            document.getElementById('final-labour-total').textContent = labourTotal.toFixed(2);
            document.getElementById('final-food-total').textContent = foodTotal.toFixed(2);
            document.getElementById('final-others-total').textContent = othersTotal.toFixed(2);
            document.getElementById('final-grand-total').textContent = (labourTotal + foodTotal + othersTotal).toFixed(2);
        }

        // ===== UTILITY FUNCTIONS =====
        function downloadCSV(csv, filename) {
            const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = filename;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            window.URL.revokeObjectURL(url);
        }

        // ===== INITIALIZATION =====
        window.onload = function() {
            populateTable();
            renderFoodTable();
            renderOthersTable();
            calculateFoodTotal();
            calculateOthersTotal();
        };
    </script>
</body>
</html>
